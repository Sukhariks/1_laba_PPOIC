import sys
from logic_game import TagGame


def main():
    print("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É \"–ü—è—Ç–Ω–∞—à–∫–∏\"")
    while True:
        show_menu()
        try:
            choice = int(input("–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –¥–ª—è –≤–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (1-3): "))
            if choice not in [1, 2, 3]:
                print("–í—ã–±–µ—Ä–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 3!")
                continue
        except ValueError:
            print("–ù—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ —á–∏—Å–ª–æ")
            continue

        match choice:
            case 1:
                rules()
            case 2:
                game_instance = TagGame()
                game(game_instance)
            case 3:
                print("–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É!")
                sys.exit(0)


def show_menu():
    print("=" * 30)
    print("         –ú–ï–ù–Æ –ò–ì–†–´")
    print("=" * 30)
    print("1. –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã")
    print("2. –ù–∞—á–∞—Ç—å –∏–≥—Ä—É")
    print("3. –í—ã—Ö–æ–¥")
    print("=" * 30)


def rules():
    print("\nüìñ –ü–†–ê–í–ò–õ–ê –ò–ì–†–´:")
    print("–¶–µ–ª—å –∏–≥—Ä—ã - —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç—å —á–∏—Å–ª–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É")
    print("–æ—Ç 1 –¥–æ 15, –æ—Å—Ç–∞–≤–∏–≤ –ø—É—Å—Ç—É—é –∫–ª–µ—Ç–∫—É –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É.")
    print("–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –∏–ª–∏ WASD –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∫–ª–µ—Ç–æ–∫.")
    input("–ù–∞–∂–º–∏—Ç–µ Enter —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é...")


def print_board(board):
    size = len(board)
    print("\n" + "=" * (size * 3))
    for x in range(size):
        row = []
        for num in board[x]:
            if num != 0:
                row.append(f"{num:2d}")
            else:
                row.append("  ")
        print(" | ".join(row))
        if x < size - 1:
            print("-" * (size * 4 - 1))
    print("=" * (size * 3))


def game(game_instance):
    game_instance.create_board()
    while True:
        print("\n–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç:")
        print("W/S/D/A - —Ö–æ–¥ (–≤–≤–µ–¥–∏ —Å–∏–º–≤–æ–ª)")
        print("1. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã")
        print("2. –í—ã—Ö–æ–¥ –≤ –º–µ–Ω—é")
        print_board(game_instance.get_board())

        choice = input("–¢–≤–æ–π —Ö–æ–¥: ").strip().lower()

        if choice not in ["1", "2", "w", "a", "s", "d"]:
            print("–í—ã–±–µ—Ä–∏—Ç–µ W/A/S/D, 1 –∏–ª–∏ 2!")
            continue

        if choice in ["w", "a", "s", "d"]:
            if game_instance.move(choice):
                if game_instance.check_win():
                    print("–ù–∞–ª–∏–≤–∞–π, –ø–æ–±–µ–¥–∞!")
                    input("–ù–∞–∂–º–∏—Ç–µ Enter —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é...")
                    return True
            else:
                print("–ù–µ–≤–æ–∑–º–æ–∂–Ω—ã–π —Ö–æ–¥")

        elif choice == "1":
            game_instance.create_board()
            print("–î–æ—Å–∫–∞ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞!")

        elif choice == "2":
            print("–¢—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å :)")
            return False


# –ì–ª–∞–≤–Ω–∞—è:
if __name__ == "__main__":
    main()
